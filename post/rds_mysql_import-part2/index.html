<!DOCTYPE html>
<html lang="en-gb">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>
  
     Importing MySQL Databases to MySQL Backed Aurora PART 2 | 
    NinjaOps
  
</title><meta name="description" content="Things Discover whilst DevOopsing"><meta name="author" content="Callum Scott">




    
        
            <link rel="stylesheet" href="/dist/main.37ab3f61b95417873748.min.css">
        
    




<link rel="canonical" href="https://ops.moncky.ninja/post/rds_mysql_import-part2/"><meta property="og:title" content="Importing MySQL Databases to MySQL Backed Aurora PART 2" />
<meta property="og:description" content="Backup your database so that RDS can import it for you." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ops.moncky.ninja/post/rds_mysql_import-part2/" />
<meta property="og:image" content="https://ops.moncky.ninja/images/codescreen.png" />
<meta property="article:published_time" content="2020-04-23T20:30:30+01:00" />
<meta property="article:modified_time" content="2020-04-23T20:30:30+01:00" />
<meta itemprop="name" content="Importing MySQL Databases to MySQL Backed Aurora PART 2">
<meta itemprop="description" content="Backup your database so that RDS can import it for you.">
<meta itemprop="datePublished" content="2020-04-23T20:30:30&#43;01:00" />
<meta itemprop="dateModified" content="2020-04-23T20:30:30&#43;01:00" />
<meta itemprop="wordCount" content="455">
<meta itemprop="image" content="https://ops.moncky.ninja/images/codescreen.png">



<meta itemprop="keywords" content="aws,rds,devops," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ops.moncky.ninja/images/codescreen.png"/>

<meta name="twitter:title" content="Importing MySQL Databases to MySQL Backed Aurora PART 2"/>
<meta name="twitter:description" content="Backup your database so that RDS can import it for you."/>

</head>
<body>
    
<nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id="navbar-main-menu">
    <div class="container">
        <a class="navbar-brand font-weight-bold" href="https://ops.moncky.ninja/">NinjaOps</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="main-menu">
            <ul class="navbar-nav ml-auto">
                
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
                
            
            </ul>
        </div>
    </div>
</nav>


    
<main class="content-page container pt-7 pb-5">
    
    <div class="row">
        <div class="col">
            <article>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="meta text-muted mb-3">
                            <p class="created text-muted text-uppercase font-weight-bold mb-1">April 23, 2020</p>
                            <span class="mr-2"><i class="fas fa-book-open mr-2"></i>455 words</span>
                            <span><i class="fas fa-clock mr-2"></i>3 mins read</span>
                        </div>

                        <h1>Importing MySQL Databases to MySQL Backed Aurora PART 2</h1>

                        
                    </div>
                </div>

                
                    
                    
                        
                            
                            <div class="row justify-content-center mb-3">
                                <div class="col-lg-10">
                                    <img data-src="/images/codescreen_hu76e93ce1d4f7af644e604a32f6db70e2_3400881_900x500_fit_box_2.png" class="img-fluid rounded mx-auto d-block" alt="Importing MySQL Databases to MySQL Backed Aurora PART 2">
                                </div>
                            </div>
                        
                    
                

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="content">
                            <p>Backup your database so that RDS can import it for you.</p>
<blockquote>
</blockquote>
<p>As I discussed in my previous post, you can simply dump an sql file generated by <code>mysldump</code> into your Aurora instance.
In the event you&rsquo;re database is more than a couple of Gigabytes in size this can be time consuming and can be costly, as
you need to have an EC2 instance available with decent bandwidth to perform the import from.</p>
<p>Fortunately Amazon allow you to import your database in a couple of different ways.  One of which is to import your database
from a backup located in S3.</p>
<p>There are a number of caveats to this which are all <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/MySQL.Procedural.Importing.html#MySQL.Procedural.Importing.Limitations">listed here</a></p>
<p>Some points to note are:</p>
<ul>
<li>You can only import your data to a new DB instance, not an existing DB instance.</li>
<li>You must use Percona XtraBackup to create the backup of your on-premises database.</li>
<li>You can&rsquo;t restore from an Amazon S3 bucket in a different AWS Region than your Amazon RDS DB instance.</li>
</ul>
<p>There are other important points listed in that part of the RDS manual so you should read them at the very least to ensure
you don&rsquo;t run into any expected trouble.</p>
<h3 id="getting-the-tools-">Getting the Tools</h3>
<p>As mentioned above you need to backup your database using the Percona XtraBackup tool.  Additionally you may also want to
install the innobackupx tool, which is a wrapper script, also from Percona, round the XtraBackup tool</p>
<p>Details on how to install these tools, along with detailed instructions can be found on the Percona website:</p>
<p><a href="https://www.percona.com/doc/percona-xtrabackup/LATEST/index.html">xtrabackup</a></p>
<p><a href="https://www.percona.com/doc/percona-xtrabackup/2.1/innobackupex/innobackupex_script.html">innobackupx</a></p>
<h3 id="a-basic-backup-">A Basic Backup</h3>
<p>To create a full backup of you database server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ innobackupex --user<span style="color:#f92672">=</span>DBUSER --password<span style="color:#f92672">=</span>DBUSERPASS /path/to/BACKUP-DIR/
</code></pre></div><p>Once its complete you can then run your BACKUP-DIR through tar and gzip to create a tar.gz file upload that to S3 and proceed</p>
<p>However, this can take a fair bit of time.  Especially if your database is a few hundred gigabytes in size.</p>
<h3 id="a-better-backup-">A Better Backup</h3>
<p>Fortunately, Percona has a better way to create backups with xtrabackup that allows for faster, and smaller backup files.</p>
<p>Percona have their own custom streaming format called <code>xbstream</code>.  You can read more about it <a href="https://www.percona.com/doc/percona-xtrabackup/2.1/xbstream/xbstream.html">here</a>.<br>
But for this all you need to know is that xbstream allows <em>simultanious compression and streaming</em>.  So with this option
we can perform the backup and the compression of our archive file at the same time.  Couple that with the <code>--parallel</code> option
which allows us to backup files in &hellip; well parallel, and the <code>--compress-threads</code> option which allows us to compress the
files in parallel we can dramatically speed up our backup.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ innobackupex --login-path<span style="color:#f92672">=</span>mysql_login /path/to/BACKUP-DIR --no-timestamp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --parallel<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --compress <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --compress-threads<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
</code></pre></div><p>This results in an <code>.xbstream</code> file which you can then upload to S3 ready for your import.</p>
                        </div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href="/tags/aws">
                                    <i class="fas fa-tag mr-2"></i>aws
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/rds">
                                    <i class="fas fa-tag mr-2"></i>rds
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/devops">
                                    <i class="fas fa-tag mr-2"></i>devops
                                </a></div>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        
                    </div>
                </div></article>
        </div>
    </div>

    <div class="related-content row mt-5 row-cols-1 row-cols-lg-3"><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/post/rds_mysql_import/" class="d-block"><img data-src="/images/codescreen_hu76e93ce1d4f7af644e604a32f6db70e2_3400881_700x350_resize_box_2.png" class="card-img-top mx-auto d-block" alt="Importing MySQL Databases to MySQL Backed Aurora PART 1"><div class="card-body">
            <h4 class="card-title">Importing MySQL Databases to MySQL Backed Aurora PART 1</h4>
            <p class="card-text text-muted text-uppercase">April 17, 2020</p>
            <div class="card-text">
                Importing MySQL Databases to MySQL Backed Aurora is on the face of it quite simple. But I ran into some issues.

            </div>
        </div>
    </a>
</div>

            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/post/myfirstpost/" class="d-block"><img data-src="/images/lightbulb_hued6e53557bdac50fa03d080efb1c817b_89076_700x350_resize_q75_box.jpg" class="card-img-top mx-auto d-block" alt="MyFirstPost"><div class="card-body">
            <h4 class="card-title">MyFirstPost</h4>
            <p class="card-text text-muted text-uppercase">April 15, 2020</p>
            <div class="card-text">
                This is my first post using Hugo blogging platform

            </div>
        </div>
    </a>
</div>

            </div></div>
</main>


    <footer class="footer text-center bg-dark py-6">
    <div class="container">
        <div class="row">
            <div class="col">
                <ul class="list-inline">
                    
                </ul>

                <p class="text-muted">
                    
                        Copyright &copy; NinjaOps 2020
                    
                </p>

                <p class="text-muted">
                Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with <a href="https://github.com/puresyntax71/hugo-theme-chunky-poster" target="_blank">Chunky Poster</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

    
    
        
            <script src="/dist/main.d608eadfe5ac0688902e.min.js"></script>
        
    








    
</body>
</html>
